{% extends "base.html" %}
{% block content %}
<h2>All Orders (Live)</h2>

<div id="admin-orders">Loading orders…</div>

<script>
async function fetchAdminOrders() {
  const res = await fetch('/api/admin/orders');
  if (!res.ok) return;
  const data = await res.json();
  const container = document.getElementById('admin-orders');
  if (!data.length) {
    container.innerHTML = '<div class="card">No orders yet.</div>';
    return;
  }
  let html = '';
  data.forEach(o => {
    html += `
      <div class="card">
        <h3>Order #${o.id} — ${o.item_name}</h3>
        <p><strong>User:</strong> ${o.username}</p>
        <p><strong>Pickup:</strong> ${o.pickup_time}</p>
        <p><strong>Total:</strong> ₹${o.total_price}</p>
        <p><strong>Status:</strong> ${o.status}</p>
        <div style="margin-top:8px">
          <form method="POST" action="/admin/orders" style="display:inline-block; margin-right:6px;">
            <input type="hidden" name="order_id" value="${o.id}">
            <input type="hidden" name="status" value="Preparing">
            <button class="btn btn-secondary" type="submit">Preparing</button>
          </form>
          <form method="POST" action="/admin/orders" style="display:inline-block; margin-right:6px;">
            <input type="hidden" name="order_id" value="${o.id}">
            <input type="hidden" name="status" value="Ready">
            <button class="btn btn-primary" type="submit">Ready</button>
          </form>
          <form method="POST" action="/admin/orders" style="display:inline-block;">
            <input type="hidden" name="order_id" value="${o.id}">
            <input type="hidden" name="status" value="Completed">
            <button class="btn btn-secondary" type="submit">Completed</button>
          </form>
        </div>
      </div>
    `;
  });
  container.innerHTML = html;
}

// initial + poll
fetchAdminOrders();
setInterval(fetchAdminOrders, 5000);
</script>
{% endblock %}
