{% extends "base.html" %}
{% block content %}
<div style="max-width:700px;margin:auto;text-align:center">
  <h1 style="color:#ff4500">üéâ Order Placed</h1>
  <p>Thank you, <strong>{{ order.username }}</strong></p>

  <div class="card" style="text-align:left;">
    <h3>Order Details</h3>
    <p><strong>Item:</strong> {{ order.item_name }}</p>
    <p><strong>Total:</strong> ‚Çπ{{ order.total_price }}</p>
    <p><strong>Pickup Time:</strong> {{ order.pickup_time }}</p>
    <p><strong>Status:</strong> <span id="receipt-status">{{ order.status }}</span></p>
    <p style="font-size:12px;color:#666">Placed: {{ order.created_at }}</p>
  </div>

  <div style="margin-top:20px;">
    <a class="btn btn-primary" href="{{ url_for('menu') }}">Order More</a>
    <a class="btn btn-secondary" href="{{ url_for('student_dashboard') }}">My Orders</a>
  </div>

  <!-- Status tracker -->
  <div style="margin-top:30px;text-align:left;">
    <h3>Progress</h3>
    <div class="tracker" id="tracker">
      <div class="step" id="s-pending">Pending</div>
      <div class="step" id="s-preparing">Preparing</div>
      <div class="step" id="s-ready">Ready</div>
      <div class="step" id="s-completed">Completed</div>
    </div>
  </div>
</div>

<style>
.tracker { display:flex; justify-content:space-between; position:relative; margin-top:10px; }
.tracker::before { content:''; position:absolute; top:18px; left:5%; width:90%; height:4px; background:#eee; z-index:0;}
.step { flex:1; text-align:center; z-index:1; color:#aaa; font-weight:500; }
.step.active { color:#ff4500; font-weight:700;}
.step::before { content:"‚óè"; display:block; margin:0 auto 8px; font-size:18px; color:#ddd; }
.step.active::before { color:#ff4500; }
</style>

<script>
const orderId = {{ order.id }};
async function refreshReceipt() {
  try {
    const res = await fetch('/api/orders');
    if (!res.ok) return;
    const data = await res.json();
    const my = data.find(o => o.id === orderId);
    if (!my) return;
    document.getElementById('receipt-status').innerText = my.status;
    // update tracker classes
    const states = ['Pending','Preparing','Ready','Completed'];
    const idx = states.indexOf(my.status);
    document.getElementById('s-pending').classList.toggle('active', idx >= 0);
    document.getElementById('s-preparing').classList.toggle('active', idx >= 1);
    document.getElementById('s-ready').classList.toggle('active', idx >= 2);
    document.getElementById('s-completed').classList.toggle('active', idx >= 3);
  } catch(e) { /* ignore */ }
}
refreshReceipt();
setInterval(refreshReceipt, 5000);
</script>
{% endblock %}
