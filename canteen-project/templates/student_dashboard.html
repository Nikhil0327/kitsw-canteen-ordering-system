{% extends "base.html" %}
{% block content %}
<h2>Welcome, {{ session['username'] }}</h2>
<p>Browse the menu and place your orders. Your orders update automatically.</p>

<div style="margin:20px 0;">
  <a class="btn btn-primary" href="{{ url_for('menu') }}">Browse Menu</a>
  <a class="btn btn-secondary" href="{{ url_for('student_dashboard') }}">My Orders</a>
</div>

<h3>Your Orders (Live)</h3>
<div id="user-orders">
  <div class="card">Loading orders…</div>
</div>

<script>
async function fetchUserOrders() {
  const res = await fetch('/api/orders');
  if (!res.ok) return;
  const data = await res.json();
  const container = document.getElementById('user-orders');
  if (!data.length) {
    container.innerHTML = '<div class="card">You have no orders yet. <a href="{{ url_for("menu") }}">Order now</a></div>';
    return;
  }
  let html = '';
  data.forEach(o => {
    html += `
      <div class="card">
        <h3>${o.item_name}</h3>
        <p class="price">₹${o.total_price}</p>
        <p><strong>Pickup:</strong> ${o.pickup_time}</p>
        <p><strong>Status:</strong> ${o.status}</p>
        <p style="font-size:12px;color:#666">Placed: ${new Date(o.created_at).toLocaleString()}</p>
      </div>
    `;
  });
  container.innerHTML = html;
}

// initial fetch and poll every 5s
fetchUserOrders();
setInterval(fetchUserOrders, 5000);
</script>
{% endblock %}
